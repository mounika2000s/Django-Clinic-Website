{% extends 'base/base.html' %}
{% block title %}Appointments{% endblock %}

{% block content %}
<div class="container mt-4">

  <h3 class="text-primary mb-4">
    {% if user.doctor_profile %}
      Dear {{ user.doctor_profile.doctor.full_name }}, Your Appointments
    {% endif %}
  </h3>


  <!-- ✅ Upcoming Appointments -->
  <h4 class="text-success mb-3">Upcoming Appointments</h4>

  <table class="table table-striped table-hover mb-5">
    <thead class="table-dark">
      <tr>
        <th>Member</th>
        <th>Relation</th>
        <th>Doctor</th>
        <th>Date</th>
        <th>Time</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for appointment in appointments %}
        {% if appointment.status != 'completed' %}
        <tr>
          <td>{{ appointment.patient.name }}</td>
          <td>{{ appointment.patient.relation_type }}</td>
          <td>{{ appointment.doctor.full_name }}</td>
          <td>{{ appointment.date }}</td>
          <td>{{ appointment.time }}</td>
          <td>{{ appointment.get_status_display }}</td>

          <td>
            <a href="{% url 'appointment_detail' appointment.id %}" class="btn btn-info btn-sm">View</a>

            {% if user.doctor_profile %}
              <a href="{% url 'doctor_appointment_update' appointment.id %}" class="btn btn-outline-success btn-sm">Update</a>
            {% elif user.is_staff %}
              <a href="{% url 'edit_appointment' appointment.id %}" class="btn btn-secondary btn-sm">Edit</a>
            {% endif %}

            {% if appointment.status == 'pending' %}
              <a href="{% url 'delete_appointment' appointment.id %}" class="btn btn-danger btn-sm">Cancel</a>
            {% endif %}
          </td>
        </tr>
        {% endif %}
      {% empty %}
      <tr><td colspan="7" class="text-center text-muted">No upcoming appointments.</td></tr>
      {% endfor %}
    </tbody>
  </table>


  <!-- ✅ Completed Appointments -->
  <h4 class="text-primary mt-4 mb-3">Completed Appointments</h4>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>Member</th>
        <th>Relation</th>
        <th>Doctor</th>
        <th>Date</th>
        <th>Time</th>
        <th>Status</th>
        <th>Diagnosis</th>
      </tr>
    </thead>

    <tbody>
      {% for appointment in appointments %}
        {% if appointment.status == 'completed' %}
        <tr>
          <td>{{ appointment.patient.name }}</td>
          <td>{{ appointment.patient.relation_type }}</td>
          <td>{{ appointment.doctor.full_name }}</td>
          <td>{{ appointment.date }}</td>
          <td>{{ appointment.time }}</td>
          <td>{{ appointment.get_status_display }}</td>
          <td>{{ appointment.diagnosis|default:"-" }}</td>
        </tr>
        {% endif %}
      {% empty %}
      <tr><td colspan="7" class="text-center text-muted">No completed appointments.</td></tr>
      {% endfor %}
    </tbody>
  </table>

</div>
{% endblock %}
  